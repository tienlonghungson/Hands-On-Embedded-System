C51 COMPILER V9.60.0.0   BAI3                                                              12/04/2021 21:31:09 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BAI3
OBJECT MODULE PLACED IN .\Objects\bai3.obj
COMPILER INVOKED BY: E:\Long\Keil5\C51\BIN\C51.EXE bai3.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\b
                    -ai3.lst) TABS(2) OBJECT(.\Objects\bai3.obj)

line level    source

   1          #include <at89x51.h>
   2          #define TH0_50ms 0x3C;
   3          #define TL0_50ms 0xB0;
   4          
   5          //Buzzer (speaker) connects on P1^5 
   6          sbit SPK  = P1^5; //Buzzer on/off
   7          sbit LED7SEG_2 = P1^2;  //Led 7-seg 3 anot
   8          sbit LED7SEG_3 = P1^3;  //Led 7-seg 4 anot
   9          
  10          int count = 0; // count number of interupt
  11          int time = 0; // current time
  12          
  13          void init(){
  14   1        //ext int 0
  15   1        EX0  = 1;     //Cho phep ngat ngoai 0
  16   1        IT0  = 1;   //Ngat theo suon
  17   1        //timer 0
  18   1        TMOD = TMOD & 0xF0; 
  19   1        TMOD = TMOD | 0x01;
  20   1        TH0  = TH0_50ms;    //Khoi tao T0
  21   1        TL0  = TL0_50ms;    //Tuong duong 55536
  22   1        TF0  = 0;       //Xoa co tran timer 0
  23   1        TR0  = 1;       //Khoi dong timer 0
  24   1        ET0  = 1;     //cho phep ngat
  25   1        EA   = 1;     //global interrupt enable
  26   1      }
  27          
  28          void display_7seg(unsigned char value){
  29   1        unsigned char const mask[10]={0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90};
  30   1        if(value < 10){
  31   2          P0=mask[value];
  32   2        }    
  33   1      }
  34          
  35          void delay(int interval){
  36   1        int i,j;
  37   1        for(i=0;i<100;i++)
  38   1        {
  39   2          for(j=0;j<interval;j++);
  40   2        }
  41   1      }
  42          
  43          void TMR0_Handler() interrupt TF0_VECTOR{
  44   1        TF0  = 0;       //clear flag
  45   1        TR0  = 0;       //stop timer
  46   1        TH0  = TH0_50ms;  //reset T0 value
  47   1        TL0  = TL0_50ms;  
  48   1        if(count>20){
  49   2          count = 0;
  50   2          time+= 1;
  51   2        }else{
  52   2          count+=1;
  53   2        }
  54   1        
C51 COMPILER V9.60.0.0   BAI3                                                              12/04/2021 21:31:09 PAGE 2   

  55   1        TR0  = 1;       //restart timer
  56   1      }
  57          
  58          void main(){
  59   1        int num, digit;
  60   1        SPK = 0;
  61   1        LED7SEG_3 = 1;
  62   1        LED7SEG_2 = 1;
  63   1        init();
  64   1        while(1){
  65   2          num = time;
  66   2          // SET LED 3
  67   2          LED7SEG_3 = 0;
  68   2          digit = num % 10;
  69   2          num = num / 10;
  70   2          display_7seg(digit);
  71   2          delay(25);
  72   2          LED7SEG_3 = 1;
  73   2          
  74   2          // SET LED 2
  75   2          LED7SEG_2 = 0;
  76   2          digit = num % 10;
  77   2          num = num / 10;
  78   2          display_7seg(digit);
  79   2          delay(25);
  80   2          LED7SEG_2 = 1;
  81   2        };
  82   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    239    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
