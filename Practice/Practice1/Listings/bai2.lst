C51 COMPILER V9.60.0.0   BAI2                                                              12/04/2021 20:55:25 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BAI2
OBJECT MODULE PLACED IN .\Objects\bai2.obj
COMPILER INVOKED BY: E:\Long\Keil5\C51\BIN\C51.EXE bai2.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\b
                    -ai2.lst) TABS(2) OBJECT(.\Objects\bai2.obj)

line level    source

   1          #include <at89x51.h>
   2          #define T_DELAY 10000
   3          unsigned int time=0;
   4          
   5          void init(){
   6   1        P3_2 = 1; //3_2 input for interrupt 0
   7   1        P3_3 = 1;
   8   1        EX0 = 1; //Cho phep ngat ngoai 0
   9   1        IT0 = 1; //Ngat theo suon
  10   1        EX1 = 1;
  11   1        IT1 = 1;
  12   1        EA = 1; //Global interrupt
  13   1      }
  14          
  15          void display_7seg(unsigned char value){
  16   1        unsigned char const mask[10]={0xC0, 0xF9, 
  17   1        0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90};
  18   1        if(value < 10){
  19   2            P0=mask[value];
  20   2        }
  21   1        P1 = 0x07;
  22   1      }
  23          
  24          void delay(unsigned int time){
  25   1          while(time--){};
  26   1      }
  27          
  28          void blink_all(){
  29   1          P2= 0xFF;
  30   1          delay(T_DELAY);
  31   1          P2=0x00;
  32   1          delay(T_DELAY);
  33   1          P2=0xFF;
  34   1          delay(T_DELAY);
  35   1      }
  36          
  37          void blink_cycle_left_to_right(){
  38   1          unsigned char i;
  39   1          P2=0xFF;
  40   1          for(i=0;i<8;++i){
  41   2              P2<<=1;
  42   2              if(i>0) P2+=1;
  43   2              delay(T_DELAY);
  44   2          }
  45   1          P2=0xFF;
  46   1      }
  47          
  48          void blink_cycle_right_to_left(){
  49   1          unsigned int i;
  50   1          P2=0xFF;
  51   1          for(i=0;i<8;++i){
  52   2              P2>>=1;
  53   2              if(i>0) P2+=1<<7;
  54   2              delay(T_DELAY);
C51 COMPILER V9.60.0.0   BAI2                                                              12/04/2021 20:55:25 PAGE 2   

  55   2          }
  56   1          P2=0xFF;
  57   1      }
  58          
  59          void blink_pair_cycle(){
  60   1          unsigned int i;
  61   1          P2=0xFF;
  62   1          P2<<=2;
  63   1          for(i=0;i<6;++i){
  64   2              P2<<=1;
  65   2              P2+=1;
  66   2              delay(T_DELAY);
  67   2          }
  68   1          P2=0xFF;
  69   1          delay(T_DELAY);
  70   1          P2>>=2;
  71   1          delay(T_DELAY);
  72   1          for (i=0;i<6;++i){
  73   2              P2>>=1;
  74   2              P2+=1<<7;
  75   2              delay(T_DELAY);
  76   2          }
  77   1          P2=0xFF;
  78   1      }
  79          
  80          void blink_accumulative(){
  81   1          unsigned char sta = 0xFF;
  82   1          unsigned char tmp=0xFF;
  83   1          unsigned int i,j,k;
  84   1          P2=0xFF;
  85   1          for (i=0;i<8;++i){
  86   2              j=8-i;
  87   2              sta=P2;
  88   2              for (k=0;k<j;++k){
  89   3                  tmp<<=1;
  90   3                  if(k>0) tmp+=1;
  91   3                  P2=tmp&sta;
  92   3                  delay(T_DELAY);
  93   3              }
  94   2          }
  95   1          tmp=P2;
  96   1          for (i=0;i<8;++i){
  97   2              tmp>>=1;
  98   2              tmp+=(1<<7);
  99   2              P2|=tmp;
 100   2              delay(T_DELAY);
 101   2          }
 102   1      }
 103          
 104          void bumping() {
 105   1          unsigned char i;
 106   1          unsigned char left = 0xFF;
 107   1          unsigned char right = 0xFF;
 108   1          P2 = 0xFF;
 109   1          for (i = 0; i < 8; i++) {
 110   2              left >>= 1;
 111   2              right <<= 1;
 112   2              if (i > 0) {
 113   3                  left += 1 << 7;
 114   3                  right += 1;
 115   3              }
 116   2              P2 = left & right;
C51 COMPILER V9.60.0.0   BAI2                                                              12/04/2021 20:55:25 PAGE 3   

 117   2              delay(T_DELAY);
 118   2          }
 119   1          P2 = 0xFF;
 120   1      }
 121          
 122          void EX0_Process() interrupt IE0_VECTOR {
 123   1          EA=0; //Cam ngat
 124   1          
 125   1          /*short job here*/
 126   1          time = (time+1)%6;
 127   1          EA=1; //Cho phep ngat
 128   1          
 129   1      }
 130          
 131          void EX1_Process() interrupt IE1_VECTOR {
 132   1          EA=0; //Cam ngat
 133   1          /*short job here*/
 134   1          time = (time+5)%6;
 135   1          EA=1; //Cho phep ngat
 136   1          
 137   1      }
 138          
 139          void main(){
 140   1          IE=0x84;
 141   1          init();
 142   1          
 143   1          while(1){
 144   2              display_7seg(time+1);
 145   2              switch(time){
 146   3                  case 0: blink_all(); delay(T_DELAY); break;
 147   3                  case 1: blink_cycle_left_to_right();delay(T_DELAY); break;
 148   3                  case 2: blink_cycle_right_to_left();delay(T_DELAY); break;
 149   3                  case 3: blink_pair_cycle();delay(T_DELAY); break;
 150   3                  case 4: blink_accumulative();delay(T_DELAY); break;
 151   3                  case 5: bumping();delay(T_DELAY);break;
 152   3                  default: break;
 153   3              } 
 154   2          }
 155   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    613    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
